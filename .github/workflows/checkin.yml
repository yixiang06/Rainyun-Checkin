# 文件: .github/workflows/ci.yml
name: Checkin

# 触发条件
on:
    workflow_dispatch:
    # 定时执行
    schedule:
      - cron: '0 8 * * *'

# 工作
jobs:
  checkin:
    runs-on: ubuntu-latest  # 使用 16GB 内存的 Linux
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v4
      
    - name: 设置 Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        
    - name: 安装依赖
      run: pip install -r requirements.txt
      
    - name: 运行
      run: python -u rainyun.py
      env:
        # 账号密码
        RAINYUN_USER: ${{ secrets.RAINYUN_USER }}
        RAINYUN_PWD: ${{ secrets.RAINYUN_PWD }}
        # # 推送服务配置 - Server酱 PUSH_KEY
        PUSH_KEY: ${{ secrets.PUSH_KEY }}
        
        # 运行配置
        TIMEOUT: ${{ secrets.TIMEOUT }}
        MAX_DELAY: ${{ secrets.Max_DELAY }}

        # 服务器管理功能
        # 雨云密钥
        RAINYUN_API_KEY: ${{ secrets.RAINYUN_API_KEY }}
        # 自动续费开关 (true/false)
        AUTO_RENEW: ${{ secrets.AUTO_RENEW }}
        # 续费触发阈值：剩余多少天时触发续费 (默认7天)
        RENEW_THRESHOLD_DAYS: ${{ secrets.RENEW_THRESHOLD_DAYS }}
        # 续费白名单：只续费指定的产品ID (逗号分隔，留空则续费所有)
        RENEW_PRODUCT_IDS: ${{ secrets.RENEW_PRODUCT_IDS }}
